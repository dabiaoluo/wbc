{% extends 'core/layout.html' %}
{% load staticfiles %}

{% block css %}
    <link rel="stylesheet" href="{% static 'page.css' %}" />
    <link rel="stylesheet" href="{% static 'lib/leaflet/leaflet.css' %}" />
    <link rel="stylesheet" href="{% static 'vertical-timeline.css' %}" />
    <link rel="stylesheet" href="{% static 'lib/leaflet/leaflet-image.js' %}" />

{% endblock %}

{% block js %}
    <script type="text/javascript" src="{% static 'lib/leaflet/leaflet.js' %}" ></script>
    <script type="text/javascript" src="{% static 'lib/OSMBuildings-Leaflet.js' %}"  ></script>
    <script type="text/javascript" src="{% static 'lib/modernizr.js' %}"  ></script>
    <script type="text/javascript" src="{% static 'lib/vertical-timeline.js' %}"  ></script>


    <script type="text/javascript">
        var _static_url = {% static '' %}
        var _tiles_url = "{{tiles_url}}";
        var _tiles_opt = {{tiles_opt|safe}};
        var _default_view = {{default_view|safe}};

        var _address = "{{ project.address|safe }}";
        var _polygon = {% if project.polygon %}{{project.polygon|safe}}{% else %}[]{% endif %};
    </script>
    <script type="text/javascript" src="{% static 'details.js' %}" ></script>
{% endblock %}

{% block content %}

    <div class="container">
        <h1> {{project.name}} </h1>
        
        {% if tags %}
        <div class="headline-tags" class="col-md-9">
            {% for tag in tags %}
                {% if tag.important %}
                <a class="taglink" href="{{tag.get_absolute_url}}">{{tag.name}}</a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        {% if gallery %}
            {% include "projects/project_gallery.html" %}
        {% else %}
            <div id="project-map" class="col-md-9"></div>
        {% endif %}
        
        <div id="subscribe-widget" class="widget col-md-3">
            <button class="btn default wbc-button">
                <span class="fa-stack">
                  <i class="fa fa-circle-thin fa-stack-2x"></i>
                  <i class="fa fa-envelope fa-stack-1x fa-lg"></i>
                </span>
                Project abonnieren
            </button>
        </div>

        {% if nextDate %}
        <div id="next-date-widget" class="widget col-md-3">
            <div class="content-container">
                <h3><i class="fa fa-calendar"> </i>Nächster Termin</h3>
                <p>{{nextDate.title}}</p>
                <p>{{nextDate.begin}}</p>
                <p>{{nextDate.address}}</p>
            </div>
        </div>
        {% endif %}
        
        {% if lastNews %}
        <div id="next-date-widget" class="widget col-md-3">
            <div class="content-container"> 
                <h3><i class="fa fa-newspaper-o"> </i>Letzte Neuigkeiten</h3>
                <p>{{lastNews.title}}</p>
                <p>{{lastNews.teaser}}</p>
                <a href={{lastNews.link}}>Mehr</a>
            </div>
        </div>
        {% endif %}

        
        {% if tags %}
        <div id="tags-widget" class="widget col-md-3">
            <div class="content-container">
                <h3><i class="fa fa-tags"> </i>Schlagworte</h3>
                {% for tag in tags %}
                    <a class="taglink" href="{{tag.get_absolute_url}}">{{tag.name}}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% if processTypes %}
            {% include "process/process_bar.html" %}
        {% endif %}

        <div class="col-md-9">
            <div class="content-container">
                <h3>Beschreibung</h3>
                <p>
                    {{ project.description | linebreaks }}
                </p>

                {% if project.description_official %}                    
                 <p>
                    <strong>Genaue örtliche Beschreibung (Amtsblatt):</strong> {{ project.description_official }}
                 </p>
                {% endif %}
                
                <p>
                    <strong>im Bezirk/in den Bezirken:</strong> {{ project.entities.all|join:", "}}
                </p>
            </div>
        </div>
        {% if gallery != true %}
        <div class="col-md-9">
            <div class="content-container">
                <div id="project-map"></div>
            </div>
        </div>
        {% endif %}

        {% if stakeholders %}
            <div class="col-md-9 stakeholders">
                <div class="content-container">
                    <h2> Wichtige Akteure </h2>
                    {% include "stakeholder/stakeholder_list.html" %}
                </div>
            </div>
        {% endif %}

        
        {% if user.is_authenticated %}
        <div class="col-md-3">
            <ul class="list-unstyled admin-area" style="margin-top: 50px;">
                <li><a class="admin-link" href="{{ project.get_update_url }}">Projekt bearbeiten</a></li>
                <li><a class="admin-link" href="{{ project.get_delete_url }}">Projekt entfernen</a></li>
                <li><a class="admin-link" href="{{new_publication_link}}?project_id={{project.pk}}">
                        Neue Veröffentlichung
                </a></li>
            </ul>
        </div>
        {% endif %}

        <div class='col-md-12'>
            <h3>Events</h3>

            {% include "projects/project_events.html" %}
        </div>
    </div>

    <div class="comments-wrapper">
        <div class="container">
            <a class="comments-create" href="" data-toggle="modal" data-target="#comment-form">
                Eigenen Kommentar hinzufügen
            </a>

            <h3>Kommentare</h3>

            {% include "comments/list.html" %}

            {% include "comments/form.html" %}
        </div>
    </div>
{% endblock %}
